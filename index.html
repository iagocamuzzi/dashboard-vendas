<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Metas de Vendas Diárias - Maio</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        .container {
            margin-top: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .chart-container {
            margin-top: 20px;
        }
        .login-container {
            max-width: 400px;
            margin: auto;
            margin-top: 50px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            max-width: 100%;
            height: auto;
        }
        .header .logo {
            float: left;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .highlight {
            background-color: #ffff99 !important;
        }
        .summary {
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .summary .card {
            flex: 1;
            margin: 10px;
            padding: 20px;
            background-color: #007bff;
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .summary .card h5 {
            margin-bottom: 15px;
        }
        .summary .card p {
            font-size: 1.2em;
            margin: 0;
        }
        /* Remove arrows from input number fields */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div class="login-container" id="login-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b0/Logo_Cacau_Show.png" alt="Logomarca Cacau Show" class="logo">
        <h2>Login</h2>
        <div class="form-group">
            <label for="username">Usuário:</label>
            <input type="text" class="form-control" id="username" onkeypress="checkEnter(event)">
        </div>
        <div class="form-group">
            <label for="password">Senha:</label>
            <input type="password" class="form-control" id="password" onkeypress="checkEnter(event)">
        </div>
        <button class="btn btn-primary btn-block" onclick="login()">Entrar</button>
        <p id="login-error" class="text-danger" style="display: none;">Usuário ou senha incorretos.</p>
    </div>

    <div class="container" id="dashboard-container" style="display: none;">
        <div class="header text-center">
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b0/Logo_Cacau_Show.png" alt="Logomarca Cacau Show" class="logo">
            <h1>Dashboard de Metas de Vendas Diárias - Maio</h1>
        </div>
        <div class="summary">
            <div class="card">
                <h5>Total Meta do Mês</h5>
                <p id="totalTarget">R$ 0.00</p>
            </div>
            <div class="card">
                <h5>Total Vendas Realizadas</h5>
                <p id="totalSales">R$ 0.00</p>
            </div>
            <div class="card">
                <h5>Percentual de Atingimento</h5>
                <p id="achievementRate">0%</p>
            </div>
        </div>
        <div class="form-container text-center">
            <div class="form-group row justify-content-center">
                <label for="day" class="col-form-label">Dia:</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="day" min="1" max="31">
                </div>
                <label for="sales" class="col-form-label">Vendas Realizadas (R$):</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="sales">
                </div>
                <button class="btn btn-primary" onclick="updateSales()">Atualizar</button>
                <button class="btn btn-success ml-2" onclick="sendWhatsAppMessage()">Enviar WhatsApp</button>
                <button class="btn btn-warning ml-2" onclick="resetSales()">Zerar Vendas</button>
            </div>
        </div>
        <div class="table-container">
            <table class="table table-bordered table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Dia</th>
                        <th>Meta (R$)</th>
                        <th>Vendas Realizadas (R$)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="salesTable">
                    <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <div class="chart-container">
            <h2 class="text-center">Progresso das Vendas</h2>
            <canvas id="salesChart" width="600" height="300"></canvas>
        </div>
        <button class="btn btn-danger" onclick="logout()">Logout</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const users = [
            { username: 'iago', password: '123456' },
            { username: 'larissa', password: '123456' },
            { username: 'mariaeduarda', password: '123456' }
        ];

        let lastUpdatedDay = null;

        function login() {
            const username = document.getElementById('username').value.toLowerCase();
            const password = document.getElementById('password').value;

            const user = users.find(user => user.username === username && user.password === password);

            if (user) {
                const loginTime = new Date().getTime();
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('loginTime', loginTime);
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'block';
                loadSalesData();
                renderTable();
                renderChart();
                updateSummary();
                // Adiciona listener para o storage event
                window.addEventListener('storage', syncSalesData);
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function checkEnter(event) {
            if (event.key === 'Enter') {
                login();
            }
        }

        const salesData = [
            { target: 0.00, sales: 0 },
            { target: 1356, sales: 0 },
            { target: 1519, sales: 0 },
            { target: 3171, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 836, sales: 0 },
            { target: 1728, sales: 0 },
            { target: 2297, sales: 0 },
            { target: 2851, sales: 0 },
            { target: 5872, sales: 0 },
            { target: 17798, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 1693, sales: 0 },
            { target: 1408, sales: 0 },
            { target: 682, sales: 0 },
            { target: 892, sales: 0 },
            { target: 1064, sales: 0 },
            { target: 1474, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 750, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 1141, sales: 0 },
            { target: 1157, sales: 0 },
            { target: 854, sales: 0 },
            { target: 1840, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 850, sales: 0 },
            { target: 1166, sales: 0 },
            { target: 1439, sales: 0 },
            { target: 0.00, sales: 0 },
            { target: 1964, sales: 0 }
        ];

        const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];

        // Zerar dados de vendas realizadas
        function resetSalesData() {
            salesData.forEach(data => data.sales = 0);
            saveSalesData();
            localStorage.setItem('updateTrigger', new Date().toISOString());
        }

        // Função para zerar vendas
        function resetSales() {
            if (confirm("Você tem certeza que deseja zerar as vendas realizadas?")) {
                resetSalesData();
                renderTable();
                renderChart();
                updateSummary();
            }
        }

        // Load sales data from localStorage
        function loadSalesData() {
            const savedData = localStorage.getItem('salesData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                parsedData.forEach((data, index) => {
                    salesData[index].sales = data.sales;
                });
            } else {
                resetSalesData();
            }
        }

        function saveSalesData() {
            localStorage.setItem('salesData', JSON.stringify(salesData));
        }

        function updateSales() {
            const day = parseInt(document.getElementById('day').value);
            const sales = parseFloat(document.getElementById('sales').value);

            if (day >= 1 && day <= 31 && !isNaN(sales) && sales >= 0) {
                salesData[day - 1].sales = sales;
                lastUpdatedDay = day;
                saveSalesData();
                renderTable();
                renderChart();
                updateSummary();
                // Limpar os campos de entrada
                document.getElementById('day').value = '';
                document.getElementById('sales').value = '';
                // Trigger storage event
                localStorage.setItem('updateTrigger', new Date().toISOString());
            } else {
                alert('Por favor, insira um dia válido e um valor de vendas.');
            }
        }

        function sendWhatsAppMessage() {
            if (lastUpdatedDay !== null) {
                const target = salesData[lastUpdatedDay - 1].target;
                const sales = salesData[lastUpdatedDay - 1].sales;
                const status = sales >= target ? 'Meta Atingida 🎉' : 'Meta Não Atingida ❌';
                const message = `📅 Dia: ${lastUpdatedDay}\n🎯 Meta: R$ ${target.toFixed(2)}\n💰 Vendas Realizadas: R$ ${sales.toFixed(2)}\n📊 Status: ${status}`;
                const phoneNumber = '5527981829452';  // Número de telefone do destinatário no formato internacional
                const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`;

                window.open(whatsappUrl, '_blank');
            } else {
                alert('Por favor, atualize as vendas de um dia primeiro.');
            }
        }

        function renderTable() {
            const tableBody = document.getElementById('salesTable');
            tableBody.innerHTML = '';
            const today = new Date().getDate();
            salesData.forEach((data, index) => {
                const date = new Date(2024, 4, index + 1); // Maio de 2024
                const dayName = dayNames[date.getDay()];
                const status = data.sales >= data.target ? 'Meta Atingida' : 'Meta Não Atingida';
                const highlightClass = (index + 1 === today) ? 'highlight' : '';
                tableBody.innerHTML += `
                    <tr class="${highlightClass}">
                        <td>${index + 1} (${dayName})</td>
                        <td>R$ ${data.target.toFixed(2)}</td>
                        <td>R$ ${data.sales.toFixed(2)}</td>
                        <td>${status}</td>
                    </tr>
                `;
            });
        }

        function renderChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const labels = Array.from({ length: 31 }, (_, i) => `${i + 1} (${dayNames[new Date(2024, 4, i + 1).getDay()]})`);
            const sales = salesData.map(data => data.sales);
            const targets = salesData.map(data => data.target);
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Vendas Realizadas',
                            data: sales,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: false
                        },
                        {
                            label: 'Meta Diária',
                            data: targets,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: false
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateSummary() {
            const totalTarget = salesData.reduce((sum, data) => sum + data.target, 0);
            const totalSales = salesData.reduce((sum, data) => sum + data.sales, 0);
            const achievementRate = (totalSales / totalTarget) * 100;

            document.getElementById('totalTarget').innerText = `R$ ${totalTarget.toFixed(2)}`;
            document.getElementById('totalSales').innerText = `R$ ${totalSales.toFixed(2)}`;
            document.getElementById('achievementRate').innerText = `${achievementRate.toFixed(2)}%`;
        }

        function syncSalesData(event) {
            if (event.key === 'salesData') {
                loadSalesData();
                renderTable();
                renderChart();
                updateSummary();
            }
        }

        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const loginTime = localStorage.getItem('loginTime');
            const currentTime = new Date().getTime();
            const sessionDuration = 5 * 60 * 1000; // 5 minutos em milissegundos

            if (isLoggedIn === 'true' && (currentTime - loginTime) < sessionDuration) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'block';
                loadSalesData();
                renderTable();
                renderChart();
                updateSummary();
                window.addEventListener('storage', syncSalesData);
            } else {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('loginTime');
            }
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('loginTime');
            location.reload();
        }

        window.onload = checkLoginStatus;

        // Initial render
        loadSalesData();
        renderTable();
        renderChart();
        updateSummary();
    </script>
</body>
</html>
